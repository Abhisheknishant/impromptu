#!/usr/bin/env node

var path = require('path'),
  net = require('net'),
  spawn = require('child_process').spawn;

var socketPath = path.resolve(__dirname + '/../etc/' + process.pid + '.sock');

var server = net.createServer(function(c) { //'connection' listener
  c.on('data', function(chunk) {
    chunk = chunk.toString().trim();

    if (chunk == 'exit')
      process.exit();
  });

  c.end('Hello, world!\n');
});

server.listen(socketPath, function(){
  spawn(__dirname + '/tu-proxy', [socketPath], { stdio: 'inherit' });
});
